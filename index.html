<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>@avatarkage/automod</title>
<link rel="icon" href="https://automod.avatarkage.com/logo.png" type="image/png" />
<meta property="og:title" content="@avatarkage/automod" />
<meta property="og:description" content="Upcoming AutoMod API for external apps. Created by AvatarKage and released under MIT license." />
<meta property="og:image" content="https://us-east-1.tixte.net/uploads/cdn.avatarka.ge/automod_banner_png.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://automod.avatarkage.com" />
<meta property="og:type" content="website" />
<meta itemprop="name" content="@avatarkage/automod" />
<meta itemprop="description" content="Upcoming AutoMod API for external apps. Created by AvatarKage and released under MIT license." />
<meta itemprop="image" content="https://us-east-1.tixte.net/uploads/cdn.avatarka.ge/automod_banner_png.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="@avatarkage/automod" />
<meta name="twitter:description" content="Upcoming AutoMod API for external apps. Created by AvatarKage and released under MIT license." />
<meta name="twitter:image" content="https://us-east-1.tixte.net/uploads/cdn.avatarka.ge/automod_banner_png.png" />
<meta name="twitter:url" content="https://automod.avatarkage.com" />
<meta name="theme-color" content="#4c58e6" />
<meta name="author" content="AvatarKage" />

<style>
    @font-face {
        font-family: 'Rethink Sans';
        src: url('rethink_sans.ttf');
    }
    body {
        display: flex;
        background: #080808;
        height: 100vh;
        overflow: hidden;
        color: #eaeaea;
        font-family: Rethink Sans, sans-serif;
        font-size: 14px;
        justify-content: center;
        align-items: center;
        scale: 1;
    }
    .scale-wrapper {
        transform: scale(1.1);
        transform-origin: center;
    }
    hr {
        border-top: 1px solid #272727;
        border-radius: 8px;
        margin: 16px 0px;
        background-color: transparent;
    }
    .vr {
        display: inline-block;
        border-left: 1px solid #272727;
        border-radius: 8px;
        width: 1px;
        margin-right: 8px;
        align-self: stretch;
        background-color: transparent;
    }
    .text_red, .severity-High {
        color: #CE1616;
    }
    .text_orange, .severity-Medium {
        color: #e85b0f;
    }
    .text_yellow, .severity-Low {
        color: #efbe0b;
    }
    .text_green, .severity-None {
        color: #13A10E;
    }
    .log-entry {
        margin-bottom: 8px;
    }
    .box {
        background: #080808;
        border: 1px solid #272727;
        border-radius: 8px;
        width: 500px;
        padding: 16px;
    }
    .box_inner {
        background: #080808;
        border: 1px solid #272727;
        border-radius: 4px;
        width: calc(100% - 32px);
        padding: 16px;
    }
    input, textarea {
        display: block;
        background: #080808;
        width: calc(100% - 16px);
        color: #eaeaea;
        border: 1px solid #272727;
        font-family: Rethink Sans, sans-serif;
        border-radius: 4px;
        padding: 8px;
        outline: none;
        resize: none;
        height: 80px;
    }
    mark {
        background: #5a4600;
        color: #eaeaea;
        border-radius: 2px;
        padding: 1px 4px;
    }
    .info {
        margin-top: 16px;
    }
</style>
</head>
<body>

<div class="scale-wrapper">
    <div class="box" style="font-size: 14px; text-align: center;">
        <b>AutoMod API</b><br>
        <div style="font-size: 12px; margin-top: 4px;"><a style="color: #eaeaea;" href="https://api.avatarka.ge/v1/automod">https://api.avatarka.ge/v1/automod</a></div><br>
        <textarea id="inputBox" placeholder="Type something..." autocomplete="off"></textarea>
        <div id="output" class="info"></div>
    </div>
</div>

<script>
  const input = document.getElementById('inputBox');
  const output = document.getElementById('output');

  async function checkText(text) {
    if (!text) {
      output.innerHTML = "";
      return;
    }

    try {
      const response = await fetch('https://api.avatarka.ge/v1/automod', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });

      if (!response.ok) {
        output.innerHTML = "Error fetching filter results.";
        return;
      }

      const data = await response.json();

      if (data.blocked) {
        const flaggedUsername = "Username";
        const flaggedHandle = "@username";
        
        const matchedWord = data.flagged;
        const reason = {
          name: data.name,
          severity: data.severity,
          message: data.message
        };
        const matchedListType = data.group;

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function highlightFlaggedWord(text, flagged) {
            if (!flagged) return text;
            const escapedFlagged = escapeRegExp(flagged);
            // Replace all occurrences, case-insensitive
            return text.replace(new RegExp(`(${escapedFlagged})`, 'gi'), '<mark>$1</mark>');
        }

        output.innerHTML = `
            <div class="box_inner" style="position: relative;">
                <img src="logo.png" width="16px" style="position: absolute; top: 16px; right: 16px;">
                <div style="display: flex; margin-bottom: 16px;">
                    <div style="font-size: 16px; display: flex; align-items: center; text-align: left;">
                        <img width="32px" style="border-radius: 32px; margin-right: 8px;" src="pfp.png">
                        <div style="display: flex; flex-direction: column; line-height: 1.2;">
                            <span><b>${flaggedUsername}</b></span>
                            <span style="font-size: 12px; opacity: 0.65;">${flaggedHandle}</span>
                        </div>
                    </div>
                </div>
                <div style="display: flex; align-items: flex-start; font-size: 14px; margin-bottom: 16px; text-align: left;">
                    <span class="vr"></span><div style="flex: 1;">${highlightFlaggedWord(text, data.flagged)}</div>
                </div>
                <div style="font-size: 10px; text-align: left; opacity: 0.65;">
                    <b>Keyword: </b>${data.matched} • <b>Filter: </b>${reason.name} (${reason.severity} Priority) • <b>Type: </b>${matchedListType}
                    <br><b>Message: </b>${reason.message}
                </div>
            </div>
        `;
      } else {
        output.innerHTML = "";
      }

    } catch (error) {
      output.innerHTML = "Error processing your request.";
      console.error(error);
    }
  }

  input.addEventListener('input', (e) => {
    checkText(e.target.value);
  });
</script>

</body>
</html>
